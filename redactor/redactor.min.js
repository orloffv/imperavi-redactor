if("undefined"===typeof RELANG)var RELANG={};var RLANG={html:"HTML",video:"Insert Video...",image:"Insert Image...",table:"Table",link:"Link",link_insert:"Insert Link ...",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table...",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File...",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align Left",align_center:"Align Center",align_right:"Align Right",align_justify:"Justify",horizontalrule:"Insert Horizontal Rule",fullscreen:"Fullscreen",deleted:"Deleted",anchor:"Anchor"};!function(a){"use strict";jQuery.fn.redactor=function(c){return"undefined"==typeof a.browser&&(a.browser={},a.browser.chrome=/Chrome/.test(navigator.userAgent),a.browser.safari=/Safari/.test(navigator.userAgent),a.browser.mozilla=/Mozilla/.test(navigator.userAgent)),this.each(function(){var d=a(this),e=d.data("redactor");e||d.data("redactor",e=new b(this,c))})};var b=function(b,c){this.$el=a(b),"undefined"!==typeof c&&"undefined"!==typeof c.lang&&"en"!==c.lang&&"undefined"!==typeof RELANG[c.lang]&&(RLANG=RELANG[c.lang]),this.opts=a.extend({lang:"en",direction:"ltr",callback:!1,keyupCallback:!1,keydownCallback:!1,execCommandCallback:!1,path:!1,css:"style.css",focus:!1,resize:!0,autoresize:!1,fixed:!1,autoformat:!0,cleanUp:!0,removeStyles:!1,removeClasses:!1,convertDivs:!0,convertLinks:!0,xhtml:!1,handler:!1,autosave:!1,interval:60,imageGetJson:!1,imageUpload:!1,imageUploadCallback:!1,fileUpload:!1,fileUploadCallback:!1,observeImages:!0,visual:!0,fullscreen:!1,overlay:!0,buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignleft","aligncenter","alignright","justify","|","horizontalrule","fullscreen"],colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],allEmptyHtml:"<p><br /></p>",mozillaEmptyHtml:"<p>&nbsp;</p>",modal_file:String()+'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>Name (optional)</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /></div></form>',modal_image_edit:String()+"<label>"+RLANG.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label>'+RLANG.link+'</label><input id="redactor_file_link" class="redactor_input" /><label>'+RLANG.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'</option><option value="left">'+RLANG.left+'</option><option value="right">'+RLANG.right+'</option></select><div id="redactor_modal_footer"><a href="javascript:void(null);" id="redactor_image_delete_btn" style="color: #000;">'+RLANG._delete+'</a><span class="redactor_btns_box"><input type="button" name="save" id="redactorSaveBtn" value="'+RLANG.save+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_image:String()+'<div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'</a><a href="javascript:void(null);">'+RLANG.choose+'</a><a href="javascript:void(null);">'+RLANG.link+'</a></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+RLANG.image_web_link+'</label><input name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /></div><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_upload_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_link:String()+'<form id="redactorInsertLinkForm" method="post" action=""><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">URL</a><a href="javascript:void(null);">Email</a><a href="javascript:void(null);">'+RLANG.anchor+'</a></div><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label>URL</label><input id="redactor_link_url" class="redactor_input"  /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_url_text" /></div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label>Email</label><input id="redactor_link_mailto" class="redactor_input" /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /></div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label>'+RLANG.anchor+'</label><input class="redactor_input" id="redactor_link_anchor"  /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /></div></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_link_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_table:String()+"<label>"+RLANG.rows+'</label><input size="5" value="2" id="redactor_table_rows" /><label>'+RLANG.columns+'</label><input size="5" value="3" id="redactor_table_columns" /><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_insert_table_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_video:String()+'<form id="redactorInsertVideoForm"><label>'+RLANG.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_video_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",toolbar:{html:{title:RLANG.html,func:"toggle"},formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:RLANG.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"show",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},add_head:{title:RLANG.add_head,func:"addHead"},delete_head:{title:RLANG.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:RLANG.delete_column,func:"deleteColumn"},delete_row:{title:RLANG.delete_row,func:"deleteRow"},delete_table:{title:RLANG.delete_table,func:"deleteTable"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,func:"showLink"},unlink:{title:RLANG.unlink,exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"justifyfull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule},fullscreen:{title:RLANG.fullscreen,func:"fullscreen"}}},c,this.$el.data()),this.dropdowns=[],this.init()};b.prototype={init:function(){this.getPath(),this.opts.toolbar!==!1&&(a.extend(this.opts.toolbar,this.opts.buttonsCustom),a.each(this.opts.buttonsAdd,a.proxy(function(a,b){this.opts.buttons.push(b)},this))),this.height=this.$el.css("height"),this.width=this.$el.css("width"),this.build();var b=this.$el.val();b=this.preformater(b),this.opts.autoformat&&(b=this.paragraphy(b)),this.$editor=this.enable(b),this.observeFocus(),this.opts.cleanUp===!0&&a(this.doc).bind("paste",a.proxy(function(){setTimeout(a.proxy(function(){var b=Math.floor(99999*Math.random()),c="";a.browser.mozilla&&(c="&nbsp;");var d=a('<span rel="pastemarkerend" id="pastemarkerend'+b+'">'+c+"</span>");this.insertNodeAtCaret(d.get(0)),this.pasteCleanUp(b)},this),100)},this)),a(this.doc).keyup(a.proxy(function(a){var b=a.keyCode||a.which;if("function"===typeof this.opts.keyupCallback&&this.opts.keyupCallback(this,a),this.opts.autoformat){if(8===b||46===b)return this.formatEmpty(a);if(13===b&&!a.shiftKey&&!a.ctrlKey&&!a.metaKey)return this.formatNewLine(a)}this.syncCode()},this)),this.buildToolbar(),this.opts.autoresize===!1?this.buildResizer():this.observeAutoResize(),this.shortcuts(),this.autoSave(),this.observeImages(),this.observeTables(),this.opts.fullscreen&&(this.opts.fullscreen=!1,this.fullscreen()),this.opts.focus&&this.focus(),this.opts.fixed&&(this.observeScroll(),a(document).scroll(a.proxy(this.observeScroll,this))),"function"===typeof this.opts.callback&&this.opts.callback(this)},shortcuts:function(){a(this.doc).keydown(a.proxy(function(b){var c=b.keyCode||b.which;return"function"===typeof this.opts.keydownCallback&&this.opts.keydownCallback(this,b),b.ctrlKey&&(90===c?this._shortcuts(b,"undo"):90===c&&b.shiftKey?this._shortcuts(b,"redo"):77===c?this._shortcuts(b,"removeFormat"):66===c?this._shortcuts(b,"bold"):73===c?this._shortcuts(b,"italic"):74===c?this._shortcuts(b,"insertunorderedlist"):75===c?this._shortcuts(b,"insertorderedlist"):76===c?this._shortcuts(b,"superscript"):72===c&&this._shortcuts(b,"subscript")),b.shiftKey||9!==c?b.shiftKey&&9===c&&this._shortcuts(b,"outdent"):this._shortcuts(b,"indent"),a.browser.webkit&&-1===navigator.userAgent.indexOf("Chrome")?this.safariShiftKeyEnter(b,c):void 0},this))},_shortcuts:function(a,b){a.preventDefault&&a.preventDefault(),this.execCommand(b,null)},getPath:function(){return this.opts.path!==!1?this.opts.path:void a("script").each(a.proxy(function(a,b){if(b.src){var c=new RegExp(/\/redactor(\.min)?\.js(\?.*)?/);b.src.match(c)&&(this.opts.path=b.src.replace(c,""))}},this))},build:function(){this.$box=a('<div class="redactor_box"></div>'),this.$frame=a('<iframe frameborder="0" scrolling="auto" style="height: '+this.height+';" class="redactor_frame"></iframe>'),this.$el.css("width","100%").hide(),this.$box.insertAfter(this.$el).append(this.$frame).append(this.$el)},write:function(a){this.doc.open(),this.doc.write(a),this.doc.close()},enable:function(b){return this.doc=this.getDoc(this.$frame.get(0)),null!==this.doc?(this.write(this.setDoc(b)),a.browser.mozilla&&this.doc.execCommand("useCSS",!1,!0),a(this.doc).find("#page")):!1},setDoc:function(a){var b='<!DOCTYPE html>\n<html><head><link media="all" type="text/css" href="'+this.opts.path+"/css/"+this.opts.css+'" rel="stylesheet"></head><body><div id="page" contenteditable="true" dir="'+this.opts.direction+'">'+a+"</div></body></html>";return b},getDoc:function(a){return a.contentDocument?a.contentDocument:a.contentWindow&&a.contentWindow.document?a.contentWindow.document:a.document?a.document:null},focus:function(){this.$editor.focus()},syncCode:function(){var a=this.formatting(this.$editor.html());this.$el.val(a)},setCode:function(a){a=this.preformater(a),this.$editor.html(a).focus(),this.syncCode()},getCode:function(){var a=this.$editor?this.$editor.html():this.$el.val();return a=this.reformater(a)},insertHtml:function(a){this.execCommand("inserthtml",a),this.observeImages()},destroy:function(){var a=this.getCode();this.$box.after(this.$el),this.$box.remove(),this.$el.val(a).show();for(var b=0;b<this.dropdowns.length;b++)this.dropdowns[b].remove(),delete this.dropdowns[b]},handler:function(){a.ajax({url:this.opts.handler,type:"POST",data:"redactor="+escape(encodeURIComponent(this.getCode())),success:a.proxy(function(a){this.setCode(a),this.syncCode()},this)})},observeFocus:function(){a(this.doc).find("body").height()<a(this.$frame.get(0).contentWindow).height()&&a(this.doc).click(a.proxy(function(){this.$editor.focus()},this))},observeImages:function(){return this.opts.observeImages===!1?!1:(a.browser.mozilla&&this.doc.execCommand("enableObjectResizing",!1,"false"),void a(this.doc).find("img").each(a.proxy(function(b,c){a.browser.msie&&a(c).attr("unselectable","on"),this.resizeImage(c)},this)))},observeTables:function(){a(this.doc).find("body").find("table").click(a.proxy(this.tableObserver,this))},observeScroll:function(){var b=a(document).scrollTop(),c=this.$box.offset().top;b>c?(this.fixed=!0,this.$toolbar.css({position:"fixed",width:"100%"})):(this.fixed=!1,this.$toolbar.css({position:"relative",width:"auto"}))},observeAutoResize:function(){this.$editor.css({"min-height":this.$el.height()+"px"}),a(this.doc).find("body").css({overflow:"hidden"}),this.setAutoSize(!1),a(this.doc).keyup(a.proxy(this.setAutoSize,this))},setAutoSize:function(a){var b=!1;a!==!1&&(b=a.keyCode||a.which);var c=this.$editor.outerHeight(!0);this.$frame.height(a!==!0||8!==b&&46!==b?c+30:c)},execCommand:function(b,c){if(this.opts.visual&&this.doc)try{a.browser.msie&&this.focus(),"inserthtml"===b&&a.browser.msie?this.doc.selection.createRange().pasteHTML(c):"formatblock"===b&&a.browser.msie?this.doc.execCommand(b,!1,"<"+c+">"):this.doc.execCommand(b,!1,c),this.syncCode(),this.focus(),"function"===typeof this.opts.execCommandCallback&&this.opts.execCommandCallback(this,b)}catch(d){}},formatNewLine:function(b){var c=this.getParentNode();if("DIV"!==c.nodeName||"page"!==c.id)return this.syncCode(),!0;b.preventDefault&&b.preventDefault();var d=a(this.getCurrentNode());if("DIV"===d.get(0).tagName&&(""===d.html()||"<br>"===d.html())){var e=a("<p>").append(d.clone().get(0).childNodes);return d.replaceWith(e),e.html("<br />"),this.setFocusNode(e.get(0)),this.syncCode(),!1}this.syncCode(),this.opts.convertLinks&&this.$editor.linkify()},safariShiftKeyEnter:function(b,c){if(b.shiftKey&&13===c){b.preventDefault();var d=a("<span><br /></span>");return this.insertNodeAtCaret(d.get(0)),this.setFocusNode(d.get(0)),this.syncCode(),!1}return!0},formatEmpty:function(b){var c=a.trim(this.$editor.html());if(a.browser.mozilla&&(c=c.replace(/<br>/gi,"")),""===c){b.preventDefault&&b.preventDefault();var d=this.opts.allEmptyHtml;a.browser.mozilla&&(d=this.opts.mozillaEmptyHtml);var e=a(d).get(0);return this.$editor.html(e),this.setFocusNode(e),this.syncCode(),!1}this.syncCode()},paragraphy:function(b){if(b=a.trim(b),""===b)return a.browser.mozilla?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml;this.opts.convertDivs&&(b=b.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"));var c=function(a,b,c){return a.replace(new RegExp(b,"g"),c)},d=function(a,d){return c(b,a,d)},e="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";return b+="\n",d("<br />\\s*<br />","\n\n"),d("(<"+e+"[^>]*>)","\n$1"),d("(</"+e+">)","$1\n\n"),d("\r\n|\r","\n"),d("\n\n+","\n\n"),d("\n?((.|\n)+?)$","<p>$1</p>\n"),d("<p>\\s*?</p>",""),d("<p>(<div[^>]*>\\s*)","$1<p>"),d("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2"),d("<p>\\s*(</?"+e+"[^>]*>)\\s*</p>","$1"),d("<p>(<li.+?)</p>","$1"),d("<p>\\s*(</?"+e+"[^>]*>)","$1"),d("(</?"+e+"[^>]*>)\\s*</p>","$1"),d("(</?"+e+"[^>]*>)\\s*<br />","$1"),d("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1"),-1!=b.indexOf("<pre")&&d("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(a,b,d,e){return c(b,"\\\\(['\"\\\\])","$1")+c(c(c(e,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"}),d("\n</p>$","</p>")},preformater:function(a){return null!==a?(a=a.replace(/<br>/gi,"<br />"),a=a.replace(/<strong\b[^>]*>([\w\W]*?)<\/strong[^>]*>/gi,"<b>$1</b>"),a=a.replace(/<em\b[^>]*>([\w\W]*?)<\/em[^>]*>/gi,"<i>$1</i>"),a=a.replace(/<del\b[^>]*>([\w\W]*?)<\/del[^>]*>/gi,"<strike>$1</strike>")):a="",a},reformater:function(a){return a=a.replace(/<br>/gi,"<br />"),a=a.replace(/<b\b[^>]*>([\w\W]*?)<\/b[^>]*>/gi,"<strong>$1</strong>"),a=a.replace(/<i\b[^>]*>([\w\W]*?)<\/i[^>]*>/gi,"<em>$1</em>"),a=a.replace(/<strike\b[^>]*>([\w\W]*?)<\/strike[^>]*>/gi,"<del>$1</del>"),a=a.replace(/<span(.*?)style="font-weight: bold;">([\w\W]*?)<\/span>/gi,"<strong>$2</strong>"),a=a.replace(/<span(.*?)style="font-style: italic;">([\w\W]*?)<\/span>/gi,"<em>$2</em>"),a=a.replace(/<span(.*?)style="font-weight: bold; font-style: italic;">([\w\W]*?)<\/span>/gi,"<em><strong>$2</strong></em>"),a=a.replace(/<span(.*?)style="font-style: italic; font-weight: bold;">([\w\W]*?)<\/span>/gi,"<strong><em>$2</em></strong>")},stripTags:function(b){var c=["code","span","div","label","a","br","p","b","i","del","strike","img","video","audio","iframe","object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6"],d=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return b.replace(d,function(b,d){return a.inArray(d.toLowerCase(),c)>"-1"?b:""})},cleanStyles:function(b,c,d){var e=d.split("="),f=e[1].split(";"),g="";return a.each(f,function(c,d){if("undefined"==typeof d)return!0;if('"'==d||"'"==d)return!0;d=d.replace(/(^"|^')/,"").replace(/("$|'$)/,"").replace(/"(.*?)"/gi,""),d=a.trim(d);var e=d.split(":");"undefined"!==typeof e[1]&&-1===e[1].search("pt")&&-1===e[1].search("cm")&&"-1"!=a.inArray(a.trim(e[0]),b)&&(g+=d+"; ")}),c.replace(d,'style="'+g+'"')},pasteCleanUp:function(b){var c=this.$editor.html();c=c.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),c=this.formattingRemove(c),c=this.stripTags(c),this.opts.removeClasses?c=c.replace(/ class="([\w\W]*?)"/gi,""):(c=c.replace(/\s*class="TOC(.*?)"/gi,""),c=c.replace(/\s*class="Heading(.*?)"/gi,""),c=c.replace(/\s*class="Body(.*?)"/gi,""),c=c.replace(/\sclass="Nonformat"/gi,""),c=c.replace(/\sclass="Mso(.*?)"/gi,""),c=c.replace(/\sclass="Apple(.*?)"/gi,""),c=c.replace(/"Times New Roman"/gi,""));var d=["width","height","src","style","href","frameborder","class","id","rel","unselectable"],e=["color","background-color","font-style","margin","margin-top","margin-bottom","margin-left","margin-right","text-align","width","height","cursor","float"],f=c.match(/([\w\-.:]+)\s*=\s*("[^"]*"|'[^']*'|[\w\-.:]+)/gi);a.each(f,a.proxy(function(b,f){var g=f.split("=");"-1"==a.inArray(g[0],d)&&(c=c.replace(f,"")),this.opts.removeStyles===!1&&"style"==g[0]&&(c=this.cleanStyles(e,c,f))},this)),this.opts.removeStyles===!1?(c=c.replace(/background-color:(\s+)transparent;\s/gi,""),c=c.replace(/font-style:(\s+)normal;\s/gi,"")):c=c.replace(/ style="([\w\W]*?)"/gi,""),c=c.replace(/((\s{2,})?|\s)style=(""|'')/gi,""),c=c.replace(/(&nbsp;){1,}/gi,"&nbsp;"),c=c.replace(/<span(\s)?>(\s)?<\/span>/gi," "),c=c.replace(/\s{2,}/g," "),c=c.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),c=c.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),c=c.replace(/<span(\s)?>([\w\W]*?)<\/span>/gi,"$2"),c=this.formattingEmptyTags(c),c=this.formattingAddBefore(c),c=this.formattingAddAfter(c),c=this.formattingIndenting(c),c=c.replace(/<p><div>/gi,""),c=c.replace(/<p>\s+\n+<(.*?)/gi,"<$1"),c=c.replace(/<\/(.*?)>\s+\n+<\/p>/gi,"</$1>"),c=c.replace(/<p style="(.*?)">(\s)?<\/p>/gi,""),c=c.replace(/<p style="(.*?)"><\/p>/gi,""),c=c.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),c=c.replace(/; ">/gi,';">'),this.$editor.html(c);var g=a(this.doc.body).find("#pastemarkerend"+b).get(0);this.setFocusNode(g),this.syncCode(),setTimeout(a.proxy(function(){a(this.doc.body).find("span[rel=pastemarkerend]").remove(),this.opts.autoresize===!0&&this.setAutoSize(!1),this.observeImages(),this.observeTables()},this),100)},formattingRemove:function(a){return a=a.replace(/\s{2,}/g," "),a=a.replace(/\n/g," "),a=a.replace(/[\t]*/g,""),a=a.replace(/\n\s*\n/g,"\n"),a=a.replace(/^[\s\n]*/g,""),a=a.replace(/[\s\n]*$/g,""),a=a.replace(/>\s+</g,"><")},formattingIndenting:function(a){return a=a.replace(/<li/g,"	<li"),a=a.replace(/<tr/g,"	<tr"),a=a.replace(/<td/g,"		<td"),a=a.replace(/<\/tr>/g,"	</tr>")},formattingEmptyTags:function(a){for(var b=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s*</p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"],c=0;c<b.length;++c){var d=b[c];a=a.replace(new RegExp(d,"gi"),"")}return a},formattingAddBefore:function(a){for(var b="\r\n",c=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"],d=0;d<c.length;++d){var e=c[d];a=a.replace(new RegExp(e,"gi"),b+e)}return a},formattingAddAfter:function(a){for(var b="\r\n",c=["</p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"],d=0;d<c.length;++d){var e=c[d];a=a.replace(new RegExp(e,"gi"),e+b)}return a},formatting:function(b){if(a.browser.msie){var c=b.match(/<(.*?)>/gi);a.each(c,function(a,c){b=b.replace(c,c.toLowerCase())}),b=b.replace(/style="(.*?)"/gi,function(a){return a.toLowerCase()}),b=b.replace(/ jQuery(.*?)=\"(.*?)\"/gi,"")}return b=b.replace(/<span([\w\W]*?)style="color:(.*?);"><span([\w\W]*?)style="background-color:(.*?);">([\w\W]*?)<\/span><\/span>/gi,'<span style="color: $2; background-color: $4;">$5</span>'),b=b.replace(/<span([\w\W]*?)style="background-color:(.*?);"><span([\w\W]*?)style="color:(.*?);">([\w\W]*?)<\/span><\/span>/gi,'<span style="color: $2; background-color: $4;">$5</span>'),b=b.replace(/<span([\w\W]*?)color="(.*?)">([\w\W]*?)<\/span\>/gi,'<span$1style="color: $2;">$3</span>'),b=b.replace(/<font([\w\W]*?)color="(.*?)">([\w\W]*?)<\/font\>/gi,'<span$1style="color: $2;">$3</span>'),b=b.replace(/<span style="(.*?)"\s+style="(.*?)"[\s]*>([\w\W]*?)<\/span\>/gi,'<span style="$1;$2">$3</span>'),b=b.replace(/<font([\w\W]*?)>([\w\W]*?)<\/font\>/gi,"<span$1>$2</span>"),b=b.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),this.opts.xhtml&&(b=b.replace(/<br>/gi,"<br />"),b=b.replace(/<br ?\/?>$/gi,""),b=b.replace(/^<br ?\/?>/gi,""),b=b.replace(/(<img [^>]+[^\/])>/gi,"$1 />")),b=b.replace(/<p><p>/g,"<p>"),b=b.replace(/<\/p><\/p>/g,"</p>"),b=b.replace(/<hr(.*?)>/g,"<hr />"),b=b.replace(/<p>&nbsp;/g,"<p>"),b=b.replace(/<p><ul>/g,"<ul>"),b=b.replace(/<p><ol>/g,"<ol>"),b=b.replace(/<\/ul><\/p>/g,"</ul>"),b=b.replace(/<\/ol><\/p>/g,"</ol>"),b=b.replace(/<p(.*?)>&nbsp;<\/p>/gi,""),b=this.formattingRemove(b),b=this.formattingEmptyTags(b),b=this.formattingAddBefore(b),b=this.formattingAddAfter(b),b=this.formattingIndenting(b)},toggle:function(){var b;this.opts.visual?(this.$frame.hide(),b=this.$editor.html(),b=a.trim(this.formatting(b)),this.$el.val(b).show().focus(),this.setBtnActive("html"),this.opts.visual=!1):(this.$el.hide(),this.$editor.html(this.$el.val()),this.$frame.show(),""===this.$editor.html()&&(b=a.browser.mozilla?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml,this.setCode(b)),this.focus(),this.setBtnInactive("html"),this.opts.visual=!0,this.observeImages(),this.observeTables(),this.opts.autoresize===!0&&this.setAutoSize(!1))},autoSave:function(){return this.opts.autosave===!1?!1:void setInterval(a.proxy(function(){a.post(this.opts.autosave,{data:this.getCode()})},this),1e3*this.opts.interval)},buildToolbar:function(){return this.opts.toolbar===!1?!1:(this.$toolbar=a("<ul>").addClass("redactor_toolbar"),this.$box.prepend(this.$toolbar),a.each(this.opts.buttons,a.proxy(function(b,c){if("|"!==c&&"undefined"!==typeof this.opts.toolbar[c]){var d=this.opts.toolbar[c];if(this.opts.fileUpload===!1&&"file"===c)return!0;var e=a("<li>");"fullscreen"===c&&a(e).addClass("redactor_toolbar_right");var f=this.buildButton(c,d);if("backcolor"===c||"fontcolor"===c||"undefined"!==typeof d.dropdown){var g=a('<div class="redactor_dropdown" style="display: none;">');g="backcolor"===c||"fontcolor"===c?this.buildColorPicker(g,c):this.buildDropdown(g,d.dropdown),this.dropdowns.push(g.appendTo(a(document.body))),this.hdlHideDropDown=a.proxy(function(a){this.hideDropDown(a,g,c)},this),this.hdlShowDropDown=a.proxy(function(a){this.showDropDown(a,g,c)},this),f.click(this.hdlShowDropDown)}this.$toolbar.append(a(e).append(f))}"|"===c&&this.$toolbar.append(a('<li class="redactor_separator"></li>'))},this)),a(document).click(this.hdlHideDropDown),void a(this.doc).click(this.hdlHideDropDown))},buildButton:function(b,c){var d=a('<a href="javascript:void(null);" title="'+c.title+'" class="redactor_btn_'+b+'"><span>&nbsp;</span></a>');return"undefined"===typeof c.func?d.click(a.proxy(function(){this.execCommand(c.exec,b)},this)):"show"!==c.func&&d.click(a.proxy(function(a){this[c.func](a)},this)),"undefined"!==typeof c.callback&&d.click(a.proxy(function(a){c.callback(this,a,b)},this)),d},buildDropdown:function(b,c){return a.each(c,a.proxy(function(c,d){"undefined"===typeof d.className&&(d.className="");var e;"undefined"!==typeof d.name&&"separator"===d.name?e=a('<a class="redactor_separator_drop">'):(e=a('<a href="javascript:void(null);" class="'+d.className+'">'+d.title+"</a>"),a(e).click("undefined"===typeof d.func?a.proxy(function(){this.execCommand(d.exec,c)},this):a.proxy(function(a){this[d.func](a)},this))),a(b).append(e)},this)),b},buildColorPicker:function(b,c){var d;d="backcolor"===c?a.browser.msie?"BackColor":"hilitecolor":"forecolor",a(b).width(210);for(var e=this.opts.colors.length,f=0;f<e;++f){var g=this.opts.colors[f],h=a('<a rel="'+g+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:g});a(b).append(h);var i=this;a(h).click(function(){a.browser.mozilla?"hilitecolor"==d?(i.execCommand("useCSS",!1,!1),i.execCommand(d,a(this).attr("rel")),i.execCommand("useCSS",!1,!0)):(i.execCommand("styleWithCSS",!1,!1),i.execCommand(d,a(this).attr("rel")),i.execCommand("styleWithCSS",!1,!0)):i.execCommand(d,a(this).attr("rel"))})}var j=a('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);return j.click("backcolor"===c?a.proxy(this.setBackgroundNone,this):a.proxy(this.setColorNone,this)),a(b).append(j),b},setBackgroundNone:function(){a(this.getParentNode()).css("background-color","transparent"),this.syncCode()},setColorNone:function(){a(this.getParentNode()).attr("color","").css("color",""),this.syncCode()},showDropDown:function(b,c,d){if(this.getBtn(d).hasClass("dropact"))this.hideAllDropDown();else{this.hideAllDropDown(),this.setBtnActive(d),this.getBtn(d).addClass("dropact");var e=this.getBtn(d).offset().left;if(this.opts.fixed&&this.fixed)a(c).css({position:"fixed",left:e+"px",top:"30px"}).show();else{var f=this.$toolbar.offset().top+30;a(c).css({position:"absolute",left:e+"px",top:f+"px"}).show()}}},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("act").removeClass("dropact"),a(".redactor_dropdown").hide()},hideDropDown:function(b,c){a(b.target).parent().hasClass("dropact")||(a(c).removeClass("act"),this.showedDropDown=!1,this.hideAllDropDown())},getSelection:function(){return this.$frame.get(0).contentWindow.getSelection?this.$frame.get(0).contentWindow.getSelection():this.$frame.get(0).contentWindow.document.selection?this.$frame.get(0).contentWindow.document.selection.createRange():void 0},getParentNode:function(){return window.getSelection?this.getSelection().getRangeAt(0).startContainer.parentNode:document.selection?this.getSelection().parentElement():void 0},getCurrentNode:function(){return window.getSelection?this.getSelection().getRangeAt(0).startContainer:document.selection?this.getSelection():void 0},setFocusNode:function(a,b){var c=this.doc.createRange(),d=this.getSelection();b=b?0:1,null!==d&&(c.selectNodeContents(a),d.addRange(c),d.collapse(a,b)),this.focus()},insertNodeAtCaret:function(a){if("undefined"!==typeof window.getSelection){var b=this.getSelection();if(b.rangeCount){var c=b.getRangeAt(0);c.collapse(!1),c.insertNode(a),c=c.cloneRange(),c.selectNodeContents(a),c.collapse(!1),b.removeAllRanges(),b.addRange(c)}}else if("undefined"!==typeof document.selection&&"Control"!==document.selection.type){var d=1===a.nodeType?a.outerHTML:a.data,e="marker_"+(""+Math.random()).slice(2);d+='<span id="'+e+'"></span>';var f=this.getSelection();f.collapse(!1),f.pasteHTML(d);var g=document.getElementById(e);f.moveToElementText(g),f.select(),g.parentNode.removeChild(g)}},getBtn:function(b){return a(this.$toolbar.find("a.redactor_btn_"+b))},setBtnActive:function(a){this.getBtn(a).addClass("act")},setBtnInactive:function(a){this.getBtn(a).removeClass("act")},changeBtnIcon:function(a,b){this.getBtn(a).addClass("redactor_btn_"+b)},removeBtnIcon:function(a,b){this.getBtn(a).removeClass("redactor_btn_"+b)},removeBtn:function(a){this.getBtn(a).remove()},addBtn:function(b,c){this.$toolbar.append(a("<li>").append(this.buildButton(b,c)))},fullscreen:function(){var b;this.opts.fullscreen===!1?(this.changeBtnIcon("fullscreen","normalscreen"),this.setBtnActive("fullscreen"),this.opts.fullscreen=!0,this.height=this.$frame.css("height"),this.width=this.$box.width()-2+"px",b=this.getCode(),this.tmpspan=a("<span></span>"),this.$box.addClass("redactor_box_fullscreen").after(this.tmpspan),a(document.body).prepend(this.$box).css("overflow","hidden"),this.$editor=this.enable(b),a(this.doc).click(a.proxy(this.hideAllDropDown,this)),this.observeFocus(),this.observeImages(),this.observeTables(),this.$box.find(".redactor_resizer").hide(),this.fullScreenResize(),a(window).resize(a.proxy(this.fullScreenResize,this)),a(document).scrollTop(0,0),this.focus()):(this.removeBtnIcon("fullscreen","normalscreen"),this.setBtnInactive("fullscreen"),this.opts.fullscreen=!1,a(window).unbind("resize",a.proxy(this.fullScreenResize,this)),a(document.body).css("overflow",""),b=this.getCode(),this.$box.removeClass("redactor_box_fullscreen").css("width","auto"),this.tmpspan.after(this.$box).remove(),this.$editor=this.enable(b),this.observeImages(),this.observeTables(),this.opts.autoresize&&this.observeAutoResize(),this.$box.find(".redactor_resizer").show(),a(this.doc).click(a.proxy(this.hideAllDropDown,this)),this.observeFocus(),this.syncCode(),this.$frame.css("height",this.height),this.$el.css("height",this.height),this.focus())
},fullScreenResize:function(){if(this.opts.fullscreen===!1)return!1;var b=a(window).height()-42;this.$box.width(a(window).width()-2),this.$frame.height(b),this.$el.height(b)},buildResizer:function(){return this.opts.resize===!1?!1:(this.$resizer=a('<div class="redactor_resizer">&mdash;</div>'),this.$box.append(this.$resizer),void this.$resizer.mousedown(a.proxy(this.initResize,this)))},initResize:function(b){b.preventDefault&&b.preventDefault(),this.splitter=b.target,this.opts.visual?(this.element_resize=this.$frame,this.element_resize.get(0).style.visibility="hidden",this.element_resize_parent=this.$el):(this.element_resize=this.$el,this.element_resize_parent=this.$frame),this.stopResizeHdl=a.proxy(this.stopResize,this),this.startResizeHdl=a.proxy(this.startResize,this),this.resizeHdl=a.proxy(this.resize,this),a(document).mousedown(this.startResizeHdl),a(document).mouseup(this.stopResizeHdl),a(this.splitter).mouseup(this.stopResizeHdl),this.null_point=!1,this.h_new=!1,this.h=this.element_resize.height()},startResize:function(){a(document).mousemove(this.resizeHdl)},resize:function(a){a.preventDefault&&a.preventDefault();var b=a.pageY;this.null_point===!1&&(this.null_point=b),this.h_new===!1&&(this.h_new=this.element_resize.height());var c=this.h_new+b-this.null_point-10;return c<=30?!0:void(c>=0&&(this.element_resize.get(0).style.height=c+"px",this.element_resize_parent.get(0).style.height=c+"px"))},stopResize:function(){a(document).unbind("mousemove",this.resizeHdl),a(document).unbind("mousedown",this.startResizeHdl),a(document).unbind("mouseup",this.stopResizeHdl),a(this.splitter).unbind("mouseup",this.stopResizeHdl),this.element_resize.get(0).style.visibility="visible"},resizeImage:function(b){var e,f,c=!1,d=!1,g=a(b).width()/a(b).height(),h=1,i=1,j=1,k=1;a(b).hover(function(){a(b).css("cursor","nw-resize")},function(){a(b).css("cursor","default"),c=!1}),a(b).mousedown(function(g){g.preventDefault&&g.preventDefault(),c=!0,d=!0,e=Math.round(g.pageX-a(b).eq(0).offset().left),f=Math.round(g.pageY-a(b).eq(0).offset().top)}),a(b).mouseup(a.proxy(function(){c=!1,this.syncCode(),this.opts.autoresize===!0&&this.setAutoSize(!1)},this)),a(b).click(a.proxy(function(a){d&&this.imageEdit(a)},this)),a(b).mousemove(function(l){if(c){d=!1;var n=(Math.round(l.pageX-a(this).eq(0).offset().left)-e,Math.round(l.pageY-a(this).eq(0).offset().top)-f),o=a(b).height(),p=parseInt(o,10)+n,q=p*g;(1===i||"number"===typeof i&&q<i&&q>j)&&a(b).width(q),(1===h||"number"===typeof h&&p<h&&p>k)&&a(b).height(p),e=Math.round(l.pageX-a(this).eq(0).offset().left),f=Math.round(l.pageY-a(this).eq(0).offset().top)}})},showTable:function(){this.modalInit(RLANG.table,"table",300,a.proxy(function(){a("#redactor_insert_table_btn").click(a.proxy(this.insertTable,this))},this),function(){a("#redactor_table_rows").focus()})},insertTable:function(){for(var b=a("#redactor_table_rows").val(),c=a("#redactor_table_columns").val(),d=a("<div></div>"),e=Math.floor(99999*Math.random()),f=a('<table id="table'+e+'"><tbody></tbody></table>'),g=0;g<b;g++){for(var h=a("<tr></tr>"),i=0;i<c;i++){var j=a("<td>&nbsp;</td>");a(h).append(j)}a(f).append(h)}a(d).append(f);var k=a(d).html();k+=a.browser.msie?"<p></p>":"<p>&nbsp;</p>",this.execCommand("inserthtml",k),this.modalClose(),this.$table=a(this.doc).find("body").find("#table"+e),this.$table.click(a.proxy(this.tableObserver,this)),this.opts.autoresize===!0&&this.setAutoSize(!1)},tableObserver:function(b){this.$table=a(b.target).parents("table"),this.$table_tr=this.$table.find("tr"),this.$table_td=this.$table.find("td"),this.$table_td.removeClass("current"),this.$tbody=a(b.target).parents("tbody"),this.$thead=a(this.$table).find("thead"),this.$current_td=a(b.target),this.$current_td.addClass("current"),this.$current_tr=a(b.target).parents("tr")},deleteTable:function(){a(this.$table).remove(),this.$table=!1,this.syncCode()},deleteRow:function(){a(this.$current_tr).remove(),this.syncCode()},deleteColumn:function(){var b=a(this.$current_td).get(0).cellIndex;a(this.$table).find("tr").each(function(){a(this).find("td").eq(b).remove()}),this.syncCode()},addHead:function(){if(0!==a(this.$table).find("thead").size())this.deleteHead();else{var b=a(this.$table).find("tr").first().clone();b.find("td").html("&nbsp;"),this.$thead=a("<thead></thead>"),this.$thead.append(b),a(this.$table).prepend(this.$thead),this.syncCode()}},deleteHead:function(){a(this.$thead).remove(),this.$thead=!1,this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(b){var c=a(this.$current_tr).clone();c.find("td").html("&nbsp;"),"after"===b?a(this.$current_tr).after(c):a(this.$current_tr).before(c),this.syncCode()},insertColumn:function(b){var c=0;this.$current_td.addClass("current"),this.$current_tr.find("td").each(function(b,d){a(d).hasClass("current")&&(c=b)}),this.$table_tr.each(function(d,e){var f=a(e).find("td").eq(c),g=f.clone();g.html("&nbsp;"),"after"===b?a(f).after(g):a(f).before(g)}),this.syncCode()},showVideo:function(){a.browser.msie&&this.markerIE(),this.modalInit(RLANG.video,"video",600,a.proxy(function(){a("#redactor_insert_video_btn").click(a.proxy(this.insertVideo,this))},this),function(){a("#redactor_insert_video_area").focus()})},insertVideo:function(){var b=a("#redactor_insert_video_area").val();b=this.stripTags(b),a.browser.msie?(a(this.doc.getElementById("span"+this.spanid)).after(b).remove(),this.syncCode()):this.execCommand("inserthtml",b),this.modalClose(),this.opts.autoresize===!0&&this.setAutoSize(!1)},imageEdit:function(b){var c=a(b.target),d=c.parent(),e=a.proxy(function(){a("#redactor_file_alt").val(c.attr("alt")),a("#redactor_image_edit_src").attr("href",c.attr("src")),a("#redactor_form_image_align").val(c.css("float")),"A"===a(d).get(0).tagName&&a("#redactor_file_link").val(a(d).attr("href")),a("#redactor_image_delete_btn").click(a.proxy(function(){this.imageDelete(c)},this)),a("#redactorSaveBtn").click(a.proxy(function(){this.imageSave(c)},this))},this);this.modalInit(RLANG.image,"image_edit",380,e)},imageDelete:function(b){a(b).remove(),this.modalClose(),this.syncCode(),this.opts.autoresize===!0&&this.setAutoSize(!1)},imageSave:function(b){var c=a(b).parent();a(b).attr("alt",a("#redactor_file_alt").val());var d=a("#redactor_form_image_align").val();a(b).css("left"===d?{"float":"left",margin:"0 10px 10px 0"}:"right"===d?{"float":"right",margin:"0 0 10px 10px"}:{"float":"none",margin:"0"});var e=a.trim(a("#redactor_file_link").val());""!==e?"A"!==a(c).get(0).tagName?a(b).replaceWith('<a href="'+e+'">'+this.outerHTML(b)+"</a>"):a(c).attr("href",e):"A"===a(c).get(0).tagName&&a(c).replaceWith(this.outerHTML(b)),this.modalClose(),this.observeImages(),this.syncCode()},showImage:function(){a.browser.msie&&this.markerIE();var b=a.proxy(function(){if(this.opts.imageGetJson!==!1?a.getJSON(this.opts.imageGetJson,a.proxy(function(b){a.each(b,a.proxy(function(b,c){var d=a('<img src="'+c.thumb+'" rel="'+c.image+'" />');a("#redactor_image_box").append(d),a(d).click(a.proxy(this.imageSetThumb,this))},this))},this)):a("#redactor_tabs a").eq(1).remove(),this.opts.imageUpload!==!1)this.isMobile()===!1&&0!==a("#redactor_file").size()&&a("#redactor_file").dragupload({url:this.opts.imageUpload,success:a.proxy(this.imageUploadCallback,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:a.proxy(this.imageUploadCallback,this)});else if(a(".redactor_tab").hide(),this.opts.imageGetJson===!1)a("#redactor_tabs").remove(),a("#redactor_tab3").show();else{var b=a("#redactor_tabs a");b.eq(0).remove(),b.eq(1).addClass("redactor_tabs_act"),a("#redactor_tab2").show()}a("#redactor_upload_btn").click(a.proxy(this.imageUploadCallbackLink,this))},this),c=a.proxy(function(){this.opts.imageUpload===!1&&this.opts.imageGetJson===!1&&a("#redactor_file_link").focus()},this);this.modalInit(RLANG.image,"image",570,b,c,!0)},imageSetThumb:function(b){this._imageSet('<img alt="" src="'+a(b.target).attr("rel")+'" />',!0)},imageUploadCallbackLink:function(){if(""!==a("#redactor_file_link").val()){var b='<img src="'+a("#redactor_file_link").val()+'" />';this._imageSet(b,!0)}else this.modalClose()},imageUploadCallback:function(a){this._imageSet(a)},_imageSet:function(b,c){var d="",e="";c!==!0?(e=a.parseJSON(b),d='<p><img src="'+e.filelink+'" /></p>'):d=b,this.focus(),a.browser.msie?(a(this.doc.getElementById("span"+this.spanid)).after(d).remove(),this.syncCode()):this.execCommand("inserthtml",d),c!==!0&&"function"===typeof this.opts.imageUploadCallback&&this.opts.imageUploadCallback(this,e),this.modalClose(),a(this.doc).find("img").load(a.proxy(function(){this.setAutoSize(!1)},this)),this.observeImages()},showLink:function(){var b=a.proxy(function(){var b=this.getSelection(),c="",d="";if(a.browser.msie){var e=this.getParentNode();if("A"===e.nodeName)this.insert_link_node=a(e),d=this.insert_link_node.text(),c=this.insert_link_node.attr("href");else{d=this.oldIE()?b.text:b.toString(),this.spanid=Math.floor(99999*Math.random());var f='<span id="span'+this.spanid+'">'+d+"</span>";""!==d&&(f='<span id="span'+this.spanid+'">'+d+"</span>"),this.execCommand("inserthtml",f)}}else b&&b.anchorNode&&"A"===b.anchorNode.parentNode.tagName?(c=b.anchorNode.parentNode.href,d=b.anchorNode.parentNode.text,""===b.toString()&&(this.insert_link_node=b.anchorNode.parentNode)):(d=b.toString(),c="");a(".redactor_link_text").val(d);var g=c.replace(top.location.href,"");0===c.search("mailto:")?(this.setModalTab(2),a("#redactor_tab_selected").val(2),a("#redactor_link_mailto").val(c.replace("mailto:",""))):0===g.search(/^#/gi)?(this.setModalTab(3),a("#redactor_tab_selected").val(3),a("#redactor_link_anchor").val(g.replace(/^#/gi,""))):a("#redactor_link_url").val(c),a("#redactor_insert_link_btn").click(a.proxy(this.insertLink,this))},this),c=function(){a("#redactor_link_url").focus()};this.modalInit(RLANG.link,"link",460,b,c)},insertLink:function(){var b=a("#redactor_tab_selected").val(),c="",d="";"1"===b?(c=a("#redactor_link_url").val(),d=a("#redactor_link_url_text").val()):"2"===b?(c="mailto:"+a("#redactor_link_mailto").val(),d=a("#redactor_link_mailto_text").val()):"3"===b&&(c="#"+a("#redactor_link_anchor").val(),d=a("#redactor_link_anchor_text").val()),this._insertLink('<a href="'+c+'">'+d+"</a> ",a.trim(d),c)},_insertLink:function(b,c,d){""!=c&&(this.insert_link_node?(a(this.insert_link_node).text(c),a(this.insert_link_node).attr("href",d),this.syncCode()):a.browser.msie?(a(this.doc.getElementById("span"+this.spanid)).replaceWith(b),this.syncCode()):this.execCommand("inserthtml",b)),this.modalClose()},showFile:function(){a.browser.msie&&this.markerIE();var b=a.proxy(function(){var b=this.getSelection(),c="";c=this.oldIE()?b.text:b.toString(),a("#redactor_filename").val(c),this.isMobile()===!1&&a("#redactor_file").dragupload({url:this.opts.fileUpload,success:a.proxy(function(a){this.fileUploadCallback(a)},this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:a.proxy(function(a){this.fileUploadCallback(a)},this)})},this);this.modalInit(RLANG.file,"file",500,b)},fileUploadCallback:function(b){var c=a.parseJSON(b),d=a("#redactor_filename").val();""===d&&(d=c.filename);var e='<a href="'+c.filelink+'">'+d+"</a>";a.browser.webkit&&window.chrome&&(e+="&nbsp;"),a.browser.msie?(""!==d?a(this.doc.getElementById("span"+this.spanid)).replaceWith(e):a(this.doc.getElementById("span"+this.spanid)).after(e).remove(),this.syncCode()):this.execCommand("inserthtml",e),"function"===typeof this.opts.fileUploadCallback&&this.opts.fileUploadCallback(this,c),this.modalClose()},modalInit:function(b,c,d,e,f,g){if(0===a("#redactor_modal_overlay").size()&&(this.overlay=a('<div id="redactor_modal_overlay" style="display: none;"></div>'),a("body").prepend(this.overlay)),this.opts.overlay&&(a("#redactor_modal_overlay").show(),a("#redactor_modal_overlay").click(a.proxy(this.modalClose,this))),0===a("#redactor_modal").size()&&(this.modal=a('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>'),a("body").append(this.modal)),a("#redactor_modal_close").click(a.proxy(this.modalClose,this)),this.hdlModalClose=a.proxy(function(a){27===a.keyCode&&this.modalClose()},this),a(document).keyup(this.hdlModalClose),a(this.doc).keyup(this.hdlModalClose),a("#redactor_modal_inner").html(this.opts["modal_"+c]),a("#redactor_modal_header").html(b),0!==a("#redactor_tabs").size()){var h=this;a("#redactor_tabs a").each(function(b,c){b++,a(c).click(function(){if(a("#redactor_tabs a").removeClass("redactor_tabs_act"),a(this).addClass("redactor_tabs_act"),a(".redactor_tab").hide(),a("#redactor_tab"+b).show(),a("#redactor_tab_selected").val(b),h.isMobile()===!1){var c=a("#redactor_modal").outerHeight();a("#redactor_modal").css("margin-top","-"+(c+10)/2+"px")}})})}a("#redactor_btn_modal_close").click(a.proxy(this.modalClose,this)),"function"===typeof e&&e();var i=a("#redactor_modal").outerHeight();this.isMobile()===!1?a("#redactor_modal").css({position:"fixed",top:"50%",left:"50%",width:d+"px",height:"auto",marginTop:"-"+(i+10)/2+"px",marginLeft:"-"+(d+60)/2+"px"}).fadeIn("fast"):(a("#redactor_modal").css({position:"absolute",width:"96%",height:"auto",top:"20px",left:"0",marginTop:"0px",marginLeft:"2%"}).show(),this.scrolltop()),"function"===typeof f&&f(),g===!0&&a("#redactor_image_box").height(300).css("overflow","auto")},modalClose:function(){a("#redactor_modal_close").unbind("click",this.modalClose),a("#redactor_modal").fadeOut("fast",a.proxy(function(){a("#redactor_modal_inner").html(""),this.opts.overlay&&(a("#redactor_modal_overlay").hide(),a("#redactor_modal_overlay").unbind("click",this.modalClose)),a(document).unbind("keyup",this.hdlModalClose),a(this.doc).unbind("keyup",this.hdlModalClose)},this))},setModalTab:function(b){a(".redactor_tab").hide();var c=a("#redactor_tabs a");c.removeClass("redactor_tabs_act"),c.eq(b-1).addClass("redactor_tabs_act"),a("#redactor_tab"+b).show()},uploadInit:function(b,c){this.uploadOptions={url:!1,success:!1,start:!1,trigger:!1,auto:!1,input:!1},a.extend(this.uploadOptions,c),0!==a("#"+b).size()&&"INPUT"===a("#"+b).get(0).tagName?(this.uploadOptions.input=a("#"+b),this.element=a(a("#"+b).get(0).form)):this.element=a("#"+b),this.element_action=this.element.attr("action"),this.uploadOptions.auto?a(this.uploadOptions.input).change(a.proxy(function(){this.element.submit(function(){return!1}),this.uploadSubmit()},this)):this.uploadOptions.trigger&&a("#"+this.uploadOptions.trigger).click(a.proxy(this.uploadSubmit,this))},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(99999*Math.random());var b=document.createElement("div"),c='<iframe style="display:none" src="about:blank" id="'+this.id+'" name="'+this.id+'"></iframe>';return b.innerHTML=c,document.body.appendChild(b),this.uploadOptions.start&&this.uploadOptions.start(),a("#"+this.id).load(a.proxy(this.uploadLoaded,this)),this.id},uploadForm:function(b,c){if(this.uploadOptions.input){var d="redactorUploadForm"+this.id,e="redactorUploadFile"+this.id;this.form=a('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+c+'" name="'+d+'" id="'+d+'" enctype="multipart/form-data"></form>');var f=this.uploadOptions.input,g=a(f).clone();a(f).attr("id",e),a(f).before(g),a(f).appendTo(this.form),a(this.form).css("position","absolute"),a(this.form).css("top","-2000px"),a(this.form).css("left","-2000px"),a(this.form).appendTo("body"),this.form.submit()}else b.attr("target",c),b.attr("method","POST"),b.attr("enctype","multipart/form-data"),b.attr("action",this.uploadOptions.url),this.element.submit()},uploadLoaded:function(){var c,b=a("#"+this.id);if(c=b.contentDocument?b.contentDocument:b.contentWindow?b.contentWindow.document:window.frames[this.id].document,"about:blank"===c.location.href)return!0;if(this.uploadOptions.success){var d=c.body.innerHTML,e=d.match(/\{.*\}/)[0];this.uploadOptions.success(e)}this.element.attr("action",this.element_action),this.element.attr("target","")},markerIE:function(){this.spanid=Math.floor(99999*Math.random()),this.execCommand("inserthtml",'<span id="span'+this.spanid+'"></span>')},oldIE:function(){return a.browser.msie&&parseInt(a.browser.version,10)<9?!0:!1},outerHTML:function(b){return a("<p>").append(a(b).eq(0).clone()).html()},normalize:function(a){return parseInt(a.replace("px",""),10)},isMobile:function(){return/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?!0:!1},scrolltop:function(){a("html,body").animate({scrollTop:0},500)}},a.fn.getDoc=function(){return a(this.data("redactor").doc)},a.fn.getFrame=function(){return this.data("redactor").$frame},a.fn.getEditor=function(){return this.data("redactor").$editor},a.fn.getCode=function(){return this.data("redactor").getCode()},a.fn.getText=function(){return this.data("redactor").$editor.text()},a.fn.setCode=function(a){this.data("redactor").setCode(a)},a.fn.insertHtml=function(a){this.data("redactor").insertHtml(a)},a.fn.destroyEditor=function(){this.data("redactor").destroy(),this.removeData("redactor")},a.fn.setFocus=function(){this.data("redactor").focus()},a.fn.execCommand=function(a,b){this.data("redactor").execCommand(a,b)}}(jQuery),function(a){"use strict";function b(b,c){this.opts=a.extend({url:!1,success:!1,preview:!1,text:RLANG.drop_file_here,atext:RLANG.or_choose},c),this.$el=a(b)}a.fn.dragupload=function(a){return this.each(function(){var c=new b(this,a);c.init()})},b.prototype={init:function(){if(!a.browser.opera&&!a.browser.msie){this.droparea=a('<div class="redactor_droparea"></div>'),this.dropareabox=a('<div class="redactor_dropareabox">'+this.opts.text+"</div>"),this.dropalternative=a('<div class="redactor_dropalternative">'+this.opts.atext+"</div>"),this.droparea.append(this.dropareabox),this.$el.before(this.droparea),this.$el.before(this.dropalternative),this.dropareabox.bind("dragover",a.proxy(function(){return this.ondrag()},this)),this.dropareabox.bind("dragleave",a.proxy(function(){return this.ondragleave()},this));var b=a.proxy(function(a){var b=parseInt(a.loaded/a.total*100,10);this.dropareabox.text("Loading "+b+"%")},this),c=jQuery.ajaxSettings.xhr();c.upload&&c.upload.addEventListener("progress",b,!1);var d=function(){return c};this.dropareabox.get(0).ondrop=a.proxy(function(b){b.preventDefault(),this.dropareabox.removeClass("hover").addClass("drop");var c=b.dataTransfer.files[0],e=new FormData;e.append("file",c),a.ajax({dataType:"html",url:this.opts.url,data:e,xhr:d,cache:!1,contentType:!1,processData:!1,type:"POST",success:a.proxy(function(a){this.opts.success!==!1&&this.opts.success(a),this.opts.preview===!0&&this.dropareabox.html(a)},this)})},this)}},ondrag:function(){return this.dropareabox.addClass("hover"),!1},ondragleave:function(){return this.dropareabox.removeClass("hover"),!1}}}(jQuery),function(a){"use strict";var b=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,c=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,d=function(){for(var e=this.childNodes,f=e.length;f--;){var g=e[f];if(3===g.nodeType){var h=g.nodeValue;h&&(h=h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(b,'$1<a href="http://$2">$2</a>$3').replace(c,'$1<a href="$2">$2</a>$5'),a(g).after(h).remove())}else 1!==g.nodeType||/^(a|button|textarea)$/i.test(g.tagName)||d.call(g)}};a.fn.linkify=function(){this.each(d)}}(jQuery);